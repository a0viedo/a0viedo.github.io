<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="description"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Running Lighthouse for every PR with Travis CI</title><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono"><!-- google analytics--><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36283546-3', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Elendur</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Running Lighthouse for every PR with Travis CI</h1><span class="post-time">May 15, 2018</span><span style="float:right; font-style: italic">Read the post in: <a href="/2018/05/15/run-lighthouse-for-every-pr-en" class="lang-link">english</a>,&nbsp;<a href="/2018/05/15/run-lighthouse-for-every-pr-es" class="lang-link">spanish</a></span><div class="post-content"><p>Hace unas semanas anunciamos el nuevo sitio de NodeConf Argentina y mientras estaba ayudando con algunas cosas del sitio se me ocurrió probar correr Lighthouse desde las Chrome Developer Tools</p>
<p align="center"><a href="https://i.imgur.com/fhZsf8v.png" target="_blank" rel="external"><img src="https://i.imgur.com/fhZsf8v.png" alt="picture of Audits tab in Chrome Developer Tools" width="600"></a><br>Open the Developer Tools and select the Audits tab to run Lighthouse</p>

<p>En ese momento la accesibilidad del sitio no era tan buena (59/100) y supe que era importante mejorarla. Empecé a pensar en formas de automatizar el reporte y poder de esa forma mejorar progresivamente. No solo serviría para el caso de accesibilidad, sino también podría informar sobre mejoras en performance, SEO y otras métricas relevantes.</p>
<h2 id="Disparando-un-build-por-cada-Pull-Request"><a href="#Disparando-un-build-por-cada-Pull-Request" class="headerlink" title="Disparando un build por cada Pull Request"></a>Disparando un build por cada Pull Request</h2><p>Quería hacer un build únicamente cuando los features están “completos” y eso en general sucede cuando se decide abrir un PR. También hay una restricción en la herramienta que utilicé que no permitirá ser ejecutada por branchs en Travis CI.</p>
<p>Después de unos 20 minutos de prueba y error con la configuración de Travis logré obtener el comportamiento que estaba buscando. Esta fue la configuración final:</p>
<p align="center"><a href="https://imgur.com/Skk5keW.png" target="_blank" rel="external"><img src="https://imgur.com/Skk5keW.png" alt="picture of Travis CI configuration" width="600"></a></p>

<p>Y necesité agregar estas líneas al archivo <code>.travis.yml</code> (tal vez quisieras cambiar el branch a “master”):</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">branches:</span></span><br><span class="line"><span class="attr">  only:</span> </span><br><span class="line"><span class="bullet">    -</span> gh-pages</span><br></pre></td></tr></table></figure>
<h2 id="lighthouse-ci"><a href="#lighthouse-ci" class="headerlink" title="lighthouse-ci"></a>lighthouse-ci</h2><p><a href="https://github.com/ebidel/lighthouse-ci" target="_blank" rel="external">lighthouse-ci</a> es un paquete genial que te permite ejecutar Lighthouse desde la terminal y puede reportar los resultados directamente a GitHub. Su documentación está muy buena. En resumen: tenés que obtener una API key, configurar esa key en Travis CI, agregar el paquete cómo una de tus dev dependencies y finalmente ejecutar <code>npm run lh https://tugenialsitio.com</code></p>
<p>Después de que el build finalice deberías ver un comentario en tu PR cómo el siguiente:</p>
<p align="center"><a href="https://i.imgur.com/saubxSE.png" target="_blank" rel="external"><img src="https://i.imgur.com/saubxSE.png" alt="picture of lighthouse-ci's comment" width="600"></a></p>

<p>Encontré algunas inconsistencias con los reportes de Lighthouse versus los reportes de Lighthouse desde la terminal, por ejemplo obteniendo diferente valor de performance, pero no encontré nada hasta ahora que lo pueda estar provocando. Tal vez crearé un issue para seguir el problema en el repositorio.</p>
<p>Si querés conocer acerca de cómo configuré el deployment con Surge.sh en Travis CI podés leer este <a href="https://medium.com/onfido-tech/travis-surge-github-auto-deploy-every-pr-branch-and-tag-a6c8c790831f" target="_blank" rel="external">blog post</a>.</p>
</div></article><ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Felendur.com&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Facebook.png"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Felendur.com&text=:%20http%3A%2F%2Felendur.com&via=a0viedo" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + '%20'  + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Twitter.png"></a></li>
  <li><a href="https://plus.google.com/share?url=http%3A%2F%2Felendur.com" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Google+.png"></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Felendur.com&title=" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/images/flat_web_icon_set/color/Reddit.png"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Felendur.com&title=&summary=&source=http%3A%2F%2Felendur.com" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/images/flat_web_icon_set/color/LinkedIn.png"></a></li>
</ul><div class="tags"><a href="/tags/ci/">ci</a><a href="/tags/travis/">travis</a><a href="/tags/lighthouse/">lighthouse</a><a href="/tags/accessibility/">accessibility</a><a href="/tags/performance/">performance</a></div><div class="paginator"><a href="/2018/05/13/node-clinic-en/" class="next"><span>Next</span><i class="fa fa-chevron-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">(function() {
var d = document, s = d.createElement('script');

s.src = '//a0viedo.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script></section><footer><div class="copyright"><p><span class="author">© 2016 Alejandro Oviedo</span></p><p class="theme">Created with <a href="https://hexo.io/">Hexo.io</a>. Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a>.</p></div><label id="back2top"><i class="fa fa-chevron-up"></i></label></footer></div></body><script src="/js/back2top.js"></script></html>