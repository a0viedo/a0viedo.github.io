<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="description"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Configurando Hexo</title><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono"><!-- google analytics--><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36283546-3', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Elendur</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Configurando Hexo</h1><span class="post-time">Jun 23, 2016</span><span style="float:right; font-style: italic">Read the post in: <a href="/2016/06/23/getting-hexo-set-up-en" class="lang-link">english</a>,&nbsp;<a href="/2016/06/23/getting-hexo-set-up-es" class="lang-link">spanish</a></span><div class="post-content"><p>Hasta ahora escribí algunas cosas que podrían ser blog posts (<a href="https://github.com/a0viedo/node-tooling" target="_blank" rel="external">node-tooling</a> o algunas partes de <a href="https://github.com/a0viedo/fullstack" target="_blank" rel="external">fullstack</a>) pero nunca dediqué el tiempo y esfuerzo necesario para armar uno. Esta es mi historia de cómo modifiqué un framework de blog para que satisfaga mis necesidades.</p>
<h2 id="Descartando-las-alternativas"><a href="#Descartando-las-alternativas" class="headerlink" title="Descartando las alternativas"></a>Descartando las alternativas</h2><p>Hace unas semanas ya que estoy trabajando en un proyecto personal con muchas visualizaciones de datos y pensé que no sólo sería una buena idea escribir acerca de eso sino también integrar interacciones con las visualizaciones en el mismo blog post. Quería la flexibilidad de poder modificar el HTML y JavaScript (más bien insertar pedazos de HTML y JavaScript en este caso) a mi voluntad.<br>Estos requerimientos terminaron descartando <a href="https://wordpress.com/" target="_blank" rel="external">Wordpress</a>, <a href="https://jekyllrb.com/" target="_blank" rel="external">Jekyll</a>, <a href="https://ghost.org/" target="_blank" rel="external">Ghost</a> y <a href="http://medium.com/" target="_blank" rel="external">Medium</a> cómo posibles alternativas. No es algo que Wordpress te limite a hacerlo pero tanto PHP cómo la estructura de Wordpress son cosas con las que no estoy familiarizado. Acá es dónde <a href="Hexo">Hexo</a> entra en escena y, de ser necesario, me sería más sencillo de entender código JavaScript.</p>
<p>Otro requerimiento muy importante para mi fué la opción de publicar posts tanto en Inglés cómo en Español.</p>
<h2 id="Siempre-hay-que-volver-a-la-fuente"><a href="#Siempre-hay-que-volver-a-la-fuente" class="headerlink" title="Siempre hay que volver a la fuente"></a>Siempre hay que volver a la fuente</h2><p>Después de instalar y crear un nuevo blog con <a href="https://www.npmjs.com/package/hexo-cli" target="_blank" rel="external">hexo-cli</a> vas a tener una estructura de directorios cómo la siguiente:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── db.json</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure></p>
<p>Dónde el directorio “source” será dónde vas a guardar tus páginas (“About”, “Tags”, etc) y todos tus posts.</p>
<p>Creé dos nuevos blog posts (podés crear uno ejecutando el comando <code>hexo new post yourtitle</code>) con un mismo identificador (leé <a href="https://hexo.io/docs/front-matter.html" target="_blank" rel="external">Front-matter</a>) para saber que aunque estén en diferentes lenguajes representan el mismo blog post. De esa forma significaría para Hexo mostrar dos posts distintos en tus secciones de “Home” o “Archives”.</p>
<p>Mi primer intento en solucionar el problema de duplicados fué modificando la lógica de los templates. Después de jugar un poco con <del>Jade</del> Pug y de resolver el problema parcialmente me dí cuenta que no se integraría correctamente con otros componentes cómo paginación y, algo más importante, que sería una solución basada en el theme actual, si por alguna razón decidiera cambiar a otro theme debería resolver el problema de nuevo.</p>
<p>Hexo tiene una colección (guardada en un archivo json generado de tu directorio “source/_posts”) para posts y esa misma colección es inyectada a todas las secciones del front-end cómo “Home”, “Archives”, “About”, etc. Agregar un parámetro a la query que retorna todos los posts no solucionaría el problema ya que borraría todos los archivos generados de los posts traducidos.</p>
<p>Tuve que seguir lo que <code>hexo generate</code> exactamente hacía para tener una idea de cómo solucionarlo: hay un directorio que contiene un archivo para cada componente que va a generar (“assets”, “page” y “post”). Mirando en el archivo <a href="https://github.com/hexojs/hexo/blob/master/lib/plugins/generator/post.js" target="_blank" rel="external">“post.js”</a> vas a encontrar que se está iterando sobre la colección de posts y agregando contenido que no es específico al post en sí, cómo las referencias <code>post.prev</code> y <code>post.next</code>. Ya que no interactua directamente con el resto de los componentes sería un buen lugar para agregar los cambios que necesito.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> translatedPosts = locals.translatedPosts.toArray();</span><br><span class="line"><span class="keyword">var</span> translatedResults = translatedPosts.map(<span class="function"><span class="keyword">function</span>(<span class="params">translatedPost</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> originalPost = results.find(<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> r.data.postId === translatedPost.postId;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  translatedPost.prev = originalPost.data.prev;</span><br><span class="line">  translatedPost.next = originalPost.data.next;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    path: translatedPost.path,</span><br><span class="line">    layout: [<span class="string">'post'</span>, <span class="string">'page'</span>, <span class="string">'index'</span>],</span><br><span class="line">    data: translatedPost</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>El código anterior va a iterar sobre una lista de posts traducidos y va a mockear las referencias <code>post.prev</code> y <code>post.next</code> para que sean las mismas que el post original tiene.</p>
<p>Ahora lo que nos falta hacer es definir la variable <code>translatedPosts</code> con la colección correspondiente:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">locals.set(<span class="string">'translatedPosts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> query = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!self.config.future) &#123;</span><br><span class="line">    query.date = &#123;$lte: <span class="built_in">Date</span>.now()&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!self._showDrafts()) &#123;</span><br><span class="line">    query.published = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  query.translated = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> db.model(<span class="string">'Post'</span>).find(query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Agregué el código anterior después de la sección de código dónde se define la referencia a <code>posts</code> en la <a href="https://github.com/a0viedo/hexo/blob/master/lib/hexo/index.js#L122" target="_blank" rel="external">línea 122 de index.js</a></p>
<p>También modifiqué el template de posts para mostrar los links de las traducciones disponibles si están presentes, pero eso si será específico al theme que se utilice.</p>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>Encontré que Hexo es de cierta forma bastante flexible y que el código es tanto entendible cómo estructurado.</p>
<p>Podés ver todos los cambios que menciono en el artículo en mi <a href="https://github.com/a0viedo/hexo" target="_blank" rel="external">fork de Hexo</a>. Si tenés preguntas o sugerencias de cómo hacer los cambios de otra forma escribime en los comentarios.</p>
</div></article><ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Felendur.com&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Facebook.png"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Felendur.com&text=:%20http%3A%2F%2Felendur.com&via=a0viedo" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + '%20'  + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Twitter.png"></a></li>
  <li><a href="https://plus.google.com/share?url=http%3A%2F%2Felendur.com" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Google+.png"></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Felendur.com&title=" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/images/flat_web_icon_set/color/Reddit.png"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Felendur.com&title=&summary=&source=http%3A%2F%2Felendur.com" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/images/flat_web_icon_set/color/LinkedIn.png"></a></li>
</ul><div class="tags"><a href="/tags/blog/">blog</a><a href="/tags/static-sites/">static sites</a><a href="/tags/hexo-io/">hexo.io</a></div><div class="paginator"></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">(function() {
var d = document, s = d.createElement('script');

s.src = '//a0viedo.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script></section><footer><div class="copyright"><p><span class="author">© 2016 Alejandro Oviedo</span></p><p class="theme">Created with <a href="https://hexo.io/">Hexo.io</a>. Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a>.</p></div><label id="back2top"><i class="fa fa-chevron-up"></i></label></footer></div></body><script src="/js/back2top.js"></script></html>