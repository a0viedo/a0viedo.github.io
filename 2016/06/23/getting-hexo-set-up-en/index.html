<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="description"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Getting Hexo set up</title><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono"><!-- google analytics--><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36283546-3', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Elendur</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Getting Hexo set up</h1><span class="post-time">Jun 23, 2016</span><span style="float:right; font-style: italic">Read the post in: <a href="/2016/06/23/getting-hexo-set-up-en" class="lang-link">english</a>,&nbsp;<a href="/2016/06/23/getting-hexo-set-up-es" class="lang-link">spanish</a></span><div class="post-content"><p>I’ve been writing some things that could fit into a blog post(<a href="https://github.com/a0viedo/node-tooling" target="_blank" rel="external">node-tooling</a> or some of the resources of <a href="https://github.com/a0viedo/fullstack" target="_blank" rel="external">fullstack</a>) but I never dedicated time and effort to set up one. This is the story on how I modified a blog framework to suit my needs.</p>
<h2 id="Narrowing-down-the-contenders"><a href="#Narrowing-down-the-contenders" class="headerlink" title="Narrowing down the contenders"></a>Narrowing down the contenders</h2><p>For a few weeks now I’ve been working on a side project with lots of data visualizations and thought it would be a good idea not only to write about it but also include some interactions in the blog post itself. I wanted the flexibility to modify the HTML and JavaScript (more like inserting chunks of HTML and JavaScript in this case) as I see fit.<br>These requirements ended up ruling out <a href="https://wordpress.com/" target="_blank" rel="external">Wordpress</a>, <a href="https://jekyllrb.com/" target="_blank" rel="external">Jekyll</a>, <a href="https://ghost.org/" target="_blank" rel="external">Ghost</a> and <a href="http://medium.com/" target="_blank" rel="external">Medium</a> as viable options. It’s not that Wordpress would restrict you to modify its source but PHP nor their huge codebase are things I’m familiar with. This is were Hexo comes in and, if necessary, I would find easier to look at JavaScript code.</p>
<p>Another very important feature for me was the ability to publish posts in both English and Spanish.</p>
<h2 id="Always-go-back-to-the-source"><a href="#Always-go-back-to-the-source" class="headerlink" title="Always go back to the source"></a>Always go back to the source</h2><p>After installing and creating a new blog with <a href="https://www.npmjs.com/package/hexo-cli" target="_blank" rel="external">hexo-cli</a> you’ll end up with a directory structure like the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── db.json</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure></p>
<p>“source” is the directory where you’ll save your pages (“About”, “Tags”, etc) and blog posts.</p>
<p>I created two new blog posts (you can create one by executing <code>hexo new post yourPostTitle</code>) with the same identifier (see <a href="https://hexo.io/docs/front-matter.html" target="_blank" rel="external">Front-matter</a>) to know that, although they are in different languages, they represent the same post. That, of course, would mean for Hexo to display two different posts in your “Home” or “Archives” pages.</p>
<p>My first attempt in solving the duplicates issue was modifying the template’s logic. After playing around with <del>Jade</del> Pug and solving the problem partially I realized it would not integrate well with other components like pagination and more importantly it would be a theme-based solution, if for some reason I decide to switch to other theme I would have to solve the problem once again.</p>
<p>Hexo has a collection (stored in a json file generated from your “source/_posts” directory) for posts and that collection is injected to all the front-end sections like “Home”, “Archive”, “About”, etc. Adding a query parameter to the query that returns all the posts wouldn’t solve the problem since it will erase all generated files from the translated posts.</p>
<p>I had to follow what exactly <code>hexo generate</code> was doing to get more insight on how to do it: there’s a folder containing a file for each component it will generate (“assets”, “page” and “post”). Looking inside the <a href="https://github.com/hexojs/hexo/blob/master/lib/plugins/generator/post.js" target="_blank" rel="external">“post.js”</a> file you’ll found that it’s iterating over the posts collection and setting up the content that it’s not specific to the post itself, like the <code>post.prev</code> and <code>post.next</code> references. Since it doesn’t interacts directly with the rest of the components it could be a good place to add the changes that I want.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> translatedPosts = locals.translatedPosts.toArray();</span><br><span class="line"><span class="keyword">var</span> translatedResults = translatedPosts.map(<span class="function"><span class="keyword">function</span>(<span class="params">translatedPost</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> originalPost = results.find(<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> r.data.postId === translatedPost.postId;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  translatedPost.prev = originalPost.data.prev;</span><br><span class="line">  translatedPost.next = originalPost.data.next;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    path: translatedPost.path,</span><br><span class="line">    layout: [<span class="string">'post'</span>, <span class="string">'page'</span>, <span class="string">'index'</span>],</span><br><span class="line">    data: translatedPost</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The previous code will iterate over a list of translated posts and mock the <code>post.prev</code> and <code>post.next</code> references to be the same ones that the original post had.</p>
<p>Now all we need to do is set the <code>translatedPosts</code> variable with our collection of translated posts:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">locals.set(<span class="string">'translatedPosts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> query = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!self.config.future) &#123;</span><br><span class="line">    query.date = &#123;$lte: <span class="built_in">Date</span>.now()&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!self._showDrafts()) &#123;</span><br><span class="line">    query.published = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  query.translated = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> db.model(<span class="string">'Post'</span>).find(query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>I added the previous code after the set up of the <code>posts</code> reference in <a href="https://github.com/a0viedo/hexo/blob/master/lib/hexo/index.js#L122" target="_blank" rel="external">line 122 of index.js</a>.</p>
<p>I’ve also modified the template for posts to show links to other translations if present, but that will remain to be theme-specific.</p>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>I found that Hexo is flexible in a lot of ways and that the code is both readable and structured.</p>
<p>You can view all the changes mentioned here at my <a href="https://github.com/a0viedo/hexo" target="_blank" rel="external">fork of Hexo</a>.  If you have questions or suggestions on other ways to do these changes please write to me on the comments.</p>
</div></article><ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Felendur.com&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Facebook.png"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Felendur.com&text=:%20http%3A%2F%2Felendur.com&via=a0viedo" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + '%20'  + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Twitter.png"></a></li>
  <li><a href="https://plus.google.com/share?url=http%3A%2F%2Felendur.com" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img src="/images/flat_web_icon_set/color/Google+.png"></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Felendur.com&title=" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/images/flat_web_icon_set/color/Reddit.png"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Felendur.com&title=&summary=&source=http%3A%2F%2Felendur.com" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/images/flat_web_icon_set/color/LinkedIn.png"></a></li>
</ul><div class="tags"><a href="/tags/blog/">blog</a><a href="/tags/static-sites/">static sites</a><a href="/tags/hexo-io/">hexo.io</a></div><div class="paginator"></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">(function() {
var d = document, s = d.createElement('script');

s.src = '//a0viedo.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script></section><footer><div class="copyright"><p><span class="author">© 2016 Alejandro Oviedo</span></p><p class="theme">Created with <a href="https://hexo.io/">Hexo.io</a>. Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a>.</p></div><label id="back2top"><i class="fa fa-chevron-up"></i></label></footer></div></body><script src="/js/back2top.js"></script></html>